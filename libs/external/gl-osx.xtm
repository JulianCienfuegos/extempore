;;; gl-osx.xtm -- OSX (Core Graphics) GL context management bindings

;; Author: Ben Swift
;; Keywords: extempore
;; Required dylibs: libGL

;;; Commentary:

;; 

;;; Code:

(sys:load-preload-check 'gl-osx)
(define *xtmlib-gl-osx-loaded* #f)

(if (or (not (defined? 'libGL))
        (not libGL))
    (begin (print-with-colors 'red 'default #t
                                  (print "Error"))
           (print ": the OSX OpenGL framework (i.e. libGL) is not loaded, cannot load platform-specific OpenGL extensions.\n")
           (error)))

;; this is the key function: it's different on the different platforms
(bind-func xtgl_get_proc_address
  (let ((libGL_ptr:i8* null))
    (lambda (name:i8*)
      (if (not (null? libGL_ptr))
          (dlsym libGL_ptr name)
          null))))

;; set the OpenGL.framework pointer in xtgl_get_proc_address
(xtgl_get_proc_address.libGL_ptr libGL)

(define *xtmlib-gl-osx-loaded* #t)
